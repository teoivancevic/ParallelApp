@page "/feed"
@using ParallelApp.Shared.Models
@inject IDialogService DialogService
@inject HttpClient Http

<PageTitle>Feed</PageTitle>
<!--
<MudAppBar Color="Color.Primary" Fixed="false" Dense="true">
    <MudChipSet @bind-SelectedChip="selected" Filter="true" Mandatory="true">
            <MudChip Text="grey" Value="1" Default="true">Default</MudChip>
            <MudChip Text="purple" Color="Color.Primary">Primary</MudChip>
            <MudChip Text="pink" Color="Color.Secondary">Secondary</MudChip>
            <MudChip Text="blue" Color="Color.Info">Info</MudChip>
            <MudChip Text="green" Color="Color.Success">Success</MudChip>
            <MudChip Text="orange" Color="Color.Warning">Warning</MudChip>
            <MudChip Text="red" Color="Color.Error">Error</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
        </MudChipSet>
</MudAppBar>

<MudTabs Elevation="4" Rounded="true" Color="@Color.Secondary">
    <MudTabPanel Text="One" />
    <MudTabPanel Text="Two" />
    <MudTabPanel Text="Three" />
    <MudTabPanel Text="Four" />
    <MudTabPanel Text="Five" />
    <MudTabPanel Text="Six" />
    <MudTabPanel Text="Seven" />
    <MudTabPanel Text="Eight" />
    <MudTabPanel Text="Nine" />
    <MudTabPanel Text="Ten" />
    <MudTabPanel Text="Eleven" />
    <MudTabPanel Text="Thirteen" />
</MudTabs>

<MudPaper Elevation="25">
    <MudToolBar>
        <MudChipSet @bind-SelectedChip="selected" Filter="true" Mandatory="true">
            <MudChip Text="grey" Value="1" Default="true">Default</MudChip>
            <MudChip Text="purple" Color="Color.Primary">Primary</MudChip>
            <MudChip Text="pink" Color="Color.Secondary">Secondary</MudChip>
            <MudChip Text="blue" Color="Color.Info">Info</MudChip>
            <MudChip Text="green" Color="Color.Success">Success</MudChip>
            <MudChip Text="orange" Color="Color.Warning">Warning</MudChip>
            <MudChip Text="red" Color="Color.Error">Error</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
            <MudChip Text="black" Color="Color.Dark">Dark</MudChip>
        </MudChipSet>
    </MudToolBar>
</MudPaper>

-->

<h3>Feed</h3>

<MudCard>
    <MudCardHeader>
        <CardHeaderContent>
            <MudIcon Icon="@Icons.Material.Filled.Info" Color="Color.Info" />
            <MudText Typo="Typo.h6">Promjena rasporeda</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudTooltip Text="Edit message" Placement="Placement.Left" Color="Color.Primary" Arrow="true">
                <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Default" />
            </MudTooltip>
            
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        <MudText>This day everything happend.</MudText>
        <MudText Typo="Typo.body2">The quick, brown fox jumps over a lazy dog.</MudText>
    </MudCardContent>
    <MudCardActions>
        <MudButton Variant="Variant.Text" Color="Color.Primary">Read More</MudButton>
    </MudCardActions>
</MudCard>

<MudFab @onclick="(()=>NewMessage(appUser))" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" IconSize="Size.Large"/>

@code {
    //MudChip selected;
    int school_id = 1;
    int user_id = 2;
    User appUser = new User();

    protected override async Task OnInitializedAsync()
    {
        await GetUserWithTags(user_id);
    }

    private async Task GetUserWithTags(int id)
    {
        appUser = await Http.GetFromJsonAsync<User>("api/user/getuserwithtags/" + id.ToString());
        StateHasChanged();
    }

    private async Task NewMessage(User postingUser)
    {
        var parameters = new DialogParameters { ["postingUser"]=postingUser };
        DialogOptions dialogOptions = new DialogOptions() { MaxWidth = MaxWidth.ExtraSmall, FullWidth = true };

        var dialog = DialogService.Show<NewMessageDialog>("Create new message", parameters, dialogOptions);
        var result = await dialog.Result;

        if (!result.Cancelled)
        {
            //In a real world scenario we would reload the data from the source here since we "removed" it in the dialog already.
            //Guid.TryParse(result.Data.ToString(), out Guid deletedServer);
            //Servers.RemoveAll(item => item.Id == deletedServer);
        }
    }
}
